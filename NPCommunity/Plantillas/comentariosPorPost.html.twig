<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Document</title>
		<script type="text/javascript" src="{{ asset('js/posts.js') }}"></script>
		<script type="text/javascript" src="{{ asset('js/busqueda.js') }}"></script>
		{# Css #}
		<link
		rel="stylesheet" href="{{ asset('css/estilo.css') }}">
		{# Alertas #}
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		{# bootstrap #}
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

	</head>
	<body>
		{% include 'barraSuperior.html.twig' %}
		<div class="container-fluid  px-5">
			<div id="contenido" class="row">
				<div class="col-12 col-lg-5 mt-1">
					<div class="col-12">
						<div class="row d-flex justify-content-center align-items-center">
							<div class="col-2 d-flex justify-content-end align-items-center">
								<img style="border-radius:100px;" onclick="volverListaPosts('{{ post.idGrupo.nombre }}')" width="40px" height="40px" src="fotos/flecha.png" alt="">
							</div>
							<div class="col-9" style="margin-left:-15px">
								<small class="text-body-secondary">Volver al grupo:
									{{ post.idGrupo.nombre }}</small>
							</div>
						</div>
					</div>
					<div class="row mt-2">
						<div class="col text-center">
							<h3>Post de @{{ post.idUsuario.nomUsuario }}
								<img style="border-radius:50px;float:" width="50px" height="50px" src="{{asset('fotos/'~ post.idUsuario.fotoPerfil)}}"></h3>
						</div>
					</div>
					<div class="row">
						<div class="col d-flex justify-content-center align-items-center">
							<div class="card" style="width: 23rem;">
								<img src="{{asset('fotos/'~ post.foto )}}" class="card-img-top" alt="...">
								<div class="card-body">
									<p class="card-text">{{ post.contenido }}</p>
									<p class="card-text">
										<div class="row">
											<div class="col-6">
												<small class="text-body-secondary">Grupo:
													{{ post.idGrupo.nombre }}
													<img style="border-radius:2px;float:" width="20px" height="20px" src="{{asset('fotos/'~ post.idGrupo.fotoPerfil)}}"></small>
											</div>
											<div class="col-6">

												{% if post.getArchivo!="" %}
													<small class="text-body-secondary">
														<a class="btn btn-outline-primary" style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;" href='../fotos/{{post.getArchivo}}' download>Descargar archivo
															<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewbox="0 0 16 16">
																<path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293z"/>
																<path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
															</svg>
														</a>
													</small>
												{% endif %}


											</div>
										</div>
										<div class="row">
											<div class="col-6">
												<small class="text-body-secondary">Comentarios:
													<span id="cantidadComentarios">
														{% if  arrComentarios == 0  %}
															0
														{% else %}
															{{arrComentarios|length}}
														{% endif %}
													</span>
												</small>
											</div>
											<div class="col-6">
												<small class="text-body-secondary">{{ post.fechaHora.format('H:i:s d-m-Y') }}</small>
											</div>
										</div>
									</p>
								</div>
							</div>
						</div>
					</div>

				</div>
				<div class="col-12 col-lg-7 mt-3">

					<div class="row">
						<div class="col text-center">
							<h3>Comentarios</h3>
						</div>
					</div>
					<div class="row" id="divScrollComentarios" style="height:670px; overflow:auto; ">
						<div class="col-12">
							<div class="row">
								<div class="col-12" id="divComentarios">
									<input id="primerComentario" hidden>
									{% if error == 0 %}

										{% for comentario in arrComentarios %}

											<div class="card mb-2">
												<h5 class="card-header">
													<div class="row">
														<div class="col-8">
															<img style="border-radius:50px;float:" width="35px" height="35px" src="{{asset('fotos/'~ comentario.idUsuario.fotoPerfil)}}">
															@{{ comentario.idUsuario.nomUsuario }}
														</div>
														<div class="col-4 d-flex align-items-center">
															<smaller style="font-size:18px" class="text-body-secondary">{{ comentario.fechaHora.format('H:i:s d-m-Y ') }}</smaller>
														</div>
													</div>
												</h5>
												<div class="card-body">
													<p class="card-text">{{ comentario.contenido }}</p>
												</div>
											</div>
										{% endfor %}

									{% elseif error == 1 %}
										<div class="row" id="noComentarios" style="height:620px;">
											<div class="col d-flex justify-content-center align-items-center">
												<div>
													<div class="row mb-3">
														<div class="col-12 text-center" style="font-style:italic">
															No hay comentarios para este post.
														</div>
													</div>
													<div class="row">
														<div class="col-12 text-center" style="font-style:italic">
															{% if app.user %}
																Sé el primero en comentar! :)
															{% else %}
																Debes
																<a href="{{ path('login') }}">iniciar sesión</a>
																para comentar.
															{% endif %}
														</div>
													</div>
												</div>
											</div>
										</div>

									{% endif %}
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col">
							{% if app.user %}
								{% if sigue %}
									<div class="row mt-3">
										<input id="idPost" value="{{ post.id }}" hidden>
										<div class="col-10"><input id="inputComentar" placeholder="Escribe tu comentario aquí" autocomplete="off" class="form-control"></div>
										<div class="col-2">
											<button class="btn btn-primary" onclick="enviarComentario()">Enviar</button>
										</div>
									</div>
								{% else %}
									<div class="row mt-3">
										<div class="col d-flex justify-content-center align-items-center">
											<span class="badge text-bg-secondary fs-6">Tienes que seguir al grupo para poder comentar</span>
										</div>
									</div>
								{% endif %}
							{% else %}
								<p style="font-style:italic">
									Debes
									<a href="{{ path('login') }}">iniciar sesión</a>
									para comentar.
								</p>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
